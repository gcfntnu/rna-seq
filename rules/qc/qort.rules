#-*- mode: snakemake -*-
"""Picard: A set of command line tools (in Java) for manipulating high-throughput sequencing (HTS) 
data and formats such as SAM/BAM/CRAM and VCF.

https://broadinstitute.github.io/picard/
"""

rule qc_bam_qort:
    input:
        gtf = join(REF_DIR, 'genes', 'genes.gtf'),
        bam = get_sorted_bam
    params:
        java_opt = '-Xms4G -Xmx4G',
        se = '--singleEnded' if len(config['read_geometry']) == 1 else '',
        max_len = '--maxReadLength {}'.format(int(config['read_geometry'][0])),
        stranded = '--stranded',
        read_strand = '--fr_secondStrand ' if LIBPREP['strand'] == 'forward' else '',
        outdir = 'logs/{sample}'
    output:
        'logs/{sample}/QC.summary.txt'
    threads:
        4
    singularity:
        'docker://quay.io/biocontainers/qorts:1.3.0--py35_0'
    shell:
        'qorts {params.java_opt} QC '
        '{params.se} '
        '{params.max_len} '
        '{params.stranded} '
        '{params.read_strand} '
        '{input.bam} '
        '{input.gtf} '
        '{params.outdir} '
