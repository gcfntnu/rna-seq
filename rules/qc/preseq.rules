#-*- mode:snakemake -*-
"""Preseq: Software for predicting library complexity and genome coverage in high-throughput sequencing.

http://smithlabresearch.org/software/preseq/
"""
extra_conf_fn = srcdir('preseq.config')
if os.path.exists(extra_conf_fn):
    with open(extra_conf_fn) as fh:
        c  = yaml.load(fh) or {}
        update_config2(config, c)

rule qc_bam_preseq_lc_extrap:
    input:
        bam = get_sorted_bam
    output:
        'logs/{sample}/{sample}.ccurve.txt'
    params:
        '-P -Q ' if len(config['read_geometry']) > 1 else '-Q '
    singularity:
        'docker://quay.io/biocontainers/preseq:2.0.3--h26b358d_2'
    threads:
        4
    shell:
        'preseq lc_extrap -B {input.bam} -o {output} {params}'
