#-*- mode: snakemake -*-

"""
Dependencies
------------
Sambamba, http://lomereiter.github.io/sambamba/

Install:
bioconda

FIXME:
Compare picardtools rmdup vs sambamba version vs STAR
"""

rule sambamba_mark_duplicates:
    input:
        bam = rules.star.output.bam,
        shared_mem = rules.clean_sharedmem_2pass.output
    output:
        bam = join(ALIGN_INTERIM, 'star', '{sample}.sorted.bam'),
        bai = join(ALIGN_INTERIM, 'star', '{sample}.sorted.bam.bai'),
    threads:
        2
    singularity:
        'docker://quay.io/biocontainers/sambamba:0.7.0--h89e63da_0'
    shell:
        'sambamba markdup -t {threads} {input.bam} {output.bam} ; sambamba index -t {threads} {output.bam}'


