#-*- mode:snakemake -*-
"""Custom set of synthetic smallrna calibrators.
"""

from os.path import join
from snakemake.workflow import srcdir

CAL_DIR = join(EXT_DIR, 'smallrna_calibrators')
    
rule calibrators_fasta:
    output:
        join(CAL_DIR, 'calibrators.fa')
    shell:
        """
        echo ">spikeIn|Cal01 spikeIn 01" >> {output}
        echo GUCCCACUCCGUAGAUCUGUUC >> {output}
        echo ">spikeIn|Cal02 spikeIn 2" >> {output}
        echo GAUGUAACGAGUUGGAAUGCAA >> {output}
        echo ">spikeIn|Cal03 spikeIn 3" >> {output}
        echo UAGCAUAUCGAGCCUGAGAACA >> {output}
        echo ">spikeIn|Cal04 spikeIn 4" >> {output}
        echo CAUCGGUCGAACUUAUGUGAAA >> {output}
        echo ">spikeIn|Cal05 spikeIn 5" >> {output}
        echo GAAGCACAUUCGCACAUCAUAU >> {output}
        echo ">spikeIn|Cal06 spikeIn 6" >> {output}
        echo UCUUAACCCGGACCAGAAACUA >> {output}
        echo ">spikeIn|Cal07 spikeIn 7" >> {output}
        echo AGGUUCCGGAUAAGUAAGAGCC >> {output}
        echo ">spikeIn|Cal08 spikeIn 8" >> {output}
        echo UAACUCCUUAAGCGAAUCUCGC >> {output}
        echo ">spikeIn|Cal09 spikeIn 9" >> {output}
        echo AAAGUAGCAUCCGAAAUACGGA >> {output}
        echo ">spikeIn|Cal10 spikeIn 10" >> {output}
        echo UGAUACGGAUGUUAUACGCAGC >> {output}
        """
rule calibrators_to_dna:
    input:
        rules.calibrators_fasta.output
    output:
        join(CAL_DIR, 'calibrators.dna.fa')
    message:
        'Converting RNA alphabet to DNA for calibrators'
    shell:
        """
        cat {input} | sed 's/U/T/g'> {output}
        """

rule calibrators_extend:
    input:
        rules.calibrators_to_dna.output
    output:
        join(CAL_DIR, 'calibrators.dna.extended.fa')
    params:
        script = srcdir('scripts/extend_calibrators.py')
    shell:
        'python {params.script} {input} {output}'
