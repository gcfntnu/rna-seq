#-*- mode:snakemake -*-
extra_conf_fn = srcdir('gcfdb.config')
if os.path.exists(extra_conf_fn):
    with open(extra_conf_fn) as fh:
        c  = yaml.load(fh) or {}
        update_config2(config, c)

ORG = config['organism']

if 'REF_DIR' in locals():
    pass
elif 'ref_dir' in config:
    REF_DIR = config['ref_dir']
elif 'reference_db' in config['db']:
    ref = config['db']['reference_db']
    if ref == 'ensembl':
        include: 'gcfdb/ensembl.db'
    if ref == 'gencode':
        include: 'gcfdb/gencode.db'

    DB_CONF = config['db'][ref]
    if '__' in ORG:
        # multi-species
        try:
            # prebuilds
            REF_DIR =  join(EXT_DIR, ref, ORG, DB_CONF['version'][ORG])
        except:
            REF_DIR = []
            for org in ORG.split('__'):
                REF_DIR.append(join(EXT_DIR, ref, org, DB_CONF['version'][org]))
    else:
        REF_DIR = join(EXT_DIR, ref, ORG, DB_CONF['version'][ORG])
else:
    REF_DIR = None


include:
    'gcfdb/spikein.db'
include:
    'gcfdb/contaminants.db'
include:
    'gcfdb/rrna.db'
