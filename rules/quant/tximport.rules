rule tximport_rds:
    input:
        files = expand(join(QUANT_INTERIM, '{quant}', '{sample}', 'quant.sf'), sample=SAMPLES),
        txinfo = join(REF_DIR, 'genes', 'transcripts.tsv')
    params:
        script = srcdir('scripts/tximport.R')
    singularity:
        'docker://gcfntnu/tximport:1.12.3'
    output:
        rds = join(QUANT_INTERIM, '{quant}', 'tximport', 'tximport_{quant}.rds')
    shell:
        'Rscript {params.script} {input.files} '
        '--txinfo {input.txinfo} '
        '-t {wildcards.quant} '
        '-o {output} '

rule tximport_gene_counts:
    input:
        rds = join(QUANT_INTERIM, '{quant}', 'tximport', 'tx_{quant}.rds'),
        txinfo = join(REF_DIR, 'genes', 'transcripts.tsv')
    params:
        script = srcdir('scripts/tximport2csv.R')
    singularity:
        'docker://gcfntnu/tximport:1.12.3'
    output:
        join(QUANT_INTERIM, '{quant}', 'tximport', 'gene_counts.tsv')
    shell:
        'Rscript {params.script} '
        '--type gene '
        '--txinfo {input.txinfo} '
        '--output {output} '
        '{input.rds} '
        
rule tximport_gene_tpm:
    input:
        rds = join(QUANT_INTERIM, '{quant}', 'tximport', 'tx_{quant}.rds'),
        txinfo = join(REF_DIR, 'genes', 'transcripts.tsv')
    params:
        script = srcdir('scripts/tximport2csv.R')
    singularity:
        'docker://gcfntnu/tximport:1.12.3'
    output:
        join(QUANT_INTERIM, '{quant}', 'tximport', 'gene_tpm.tsv')
    shell:
        'Rscript {params.script} '
        '--type gene_tpm '
        '--txinfo {input.txinfo} '
        '--output {output} '
        '{input.rds} '

rule tximport_gene_tpm_scaled:
    input:
        rds = join(QUANT_INTERIM, '{quant}', 'tximport', 'tx_{quant}.rds'),
        txinfo = join(REF_DIR, 'genes', 'transcripts.tsv')
    params:
        script = srcdir('scripts/tximport2csv.R')
    singularity:
        'docker://gcfntnu/tximport:1.12.3'
    output:
        join(QUANT_INTERIM, '{quant}', 'tximport', 'gene_tpm_scaled.tsv')
    shell:
        'Rscript {params.script} '
        '--type gene_tpm '
        '--txinfo {input.txinfo} '
        '--output {output} '
        '{input.rds} '
        
rule tximport_gene_tpm_length_scaled:
    input:
        rds = join(QUANT_INTERIM, '{quant}', 'tximport', 'tx_{quant}.rds'),
        txinfo = join(REF_DIR, 'genes', 'transcripts.tsv')
    params:
        script = srcdir('scripts/tximport2csv.R')
    singularity:
        'docker://gcfntnu/tximport:1.12.3'
    output:
        join(QUANT_INTERIM, '{quant}', 'tximport', 'gene_tpm_length_scaled.tsv')
    shell:
        'Rscript {params.script} '
        '--type gene_tpm '
        '--txinfo {input.txinfo} '
        '--output {output} '
        '{input.rds} '

rule tximport_transcript_counts:
    input:
        rds = join(QUANT_INTERIM, '{quant}', 'tximport', 'tx_{quant}.rds'),
        txinfo = join(REF_DIR, 'genes', 'transcripts.tsv')
    params:
        script = srcdir('scripts/tximport2csv.R')
    singularity:
        'docker://gcfntnu/tximport:1.12.3'
    output:
        join(QUANT_INTERIM, '{quant}', 'tximport', 'transcript_counts.tsv')
    shell:
        'Rscript {params.script} '
        '--type tx '
        '--txinfo {input.txinfo} '
        '--output {output} '
        '{input.rds} '
        
rule tximport_transcript_tpm:
    input:
        rds = join(QUANT_INTERIM, '{quant}', 'tximport', 'tx_{quant}.rds'),
        txinfo = join(REF_DIR, 'genes', 'transcripts.tsv')
    params:
        script = srcdir('scripts/tximport2csv.R')
    singularity:
        'docker://gcfntnu/tximport:1.12.3'
    output:
        join(QUANT_INTERIM, '{quant}', 'tximport', 'transcript_tpm.tsv')
    shell:
        'Rscript {params.script} '
        '--type tx '
        '--txinfo {input.txinfo} '
        '--output {output} '
        '{input.rds} '      

